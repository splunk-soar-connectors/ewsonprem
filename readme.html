<!-- File: readme.html
  Copyright (c) 2016-2021 Splunk Inc.

  SPLUNK CONFIDENTIAL - Use or disclosure of this material in whole or in part
  without a valid written license from Splunk Inc. is PROHIBITED.
-->
<p>Use the Microsoft Exchange On-Premise EWS app to access a user's mailbox via EWS XML SOAP calls on an on-premise Exchange server. This can be done through impersonation, or high-level permissions. To use Splunk Phantom to organize and gain insights from email data, you need to install and connect Splunk Phantom to the Microsoft Exchange On-Premise EWS app.</p>
<h2>Impersonation and privileges</h2>
<p>When using impersonation, the app uses the current user to impersonate the target user to perform commands in the mailboxes the target user has access to. This can be configured in the user interface. When using high level permissions, many organizations configure an Exchange administrator account that has access to certain mailboxes. To give access to a user's mailbox to another user, use the <strong>Add-MailboxPermission</strong> PowerShell cmdlet on the Exchange Server.</p>
<h2>Configuration</h2>
    <ul>
        <li>EWS URL: The URL configured by the person that set up the Exchange server.</li>
        <li>EWS Version: Ensure the version in the dropdown corresponds to the version of Exchange you have installed.&nbsp;</li>
        <li>Username and Password: Use the username and password that have the correct privileges to access other mailboxes.&nbsp;</li>
        <li>(Optional) User Email Mailbox: The mailbox you will ingest data from if you use polling and to test connectivity.&nbsp;</li>
        <li>On poll information: Configure your desired on poll settings. For example, how to ingest, the number of emails to poll, what type of information you want to extract, and once extracted, your desired level of container severity. For more information on using on poll data ingestion, see Use on poll data ingestion.&nbsp;</li>
    </ul>
<h2 id="poll_now">POLL NOW</h2>
    <p>
    POLL NOW should be used to get a sense of the containers and artifacts that are created by the app. The POLL NOW window allows the user to set the "Maximum containers" that should be ingested at this instance. Since a single container is created for each email, this value equates to the maximum emails that are ingested by the app. The app will either get the oldest email first or the latest, depending upon the configuration parameter <i>How to ingest</i>. The date used to determine the oldest or latest is what EWS calls <b>item:LastModifiedTime</b>. This value is different than the mail creation time. For example, if an email that arrived a week ago, is moved from one folder to the folder being ingested, its LastModifiedTime will be set to the time that it was moved.
    <br/> <br/> <b>Note</b>: "Mailbox folder to be polled" parameter is case-sensitive.
    </p>
<h2 id="scheduled_polling">Scheduled Polling</h2>
    <p>This mode is used to schedule a polling action on the asset at regular intervals, which is configured via the INGEST SETTINGS tab of the asset. It makes use of the following asset configuration parameters (among others):</p>
    <ul>
        <li>Maximum emails to poll the first time</li>
            The app detects the first time it is polling an asset and will ingest this number of emails (at the most).
        <li>Maximum emails to poll</li>
            For all scheduled polls after the first, the app will ingest this number of emails.
        <li>How to ingest</li>
            Should the app be ingesting the latest emails or the oldest.
    </ul>
    <p>In the case of Scheduled Polling, on every poll, the app remembers the last email that it has ingested and will pick up from the next one in the next scheduled poll.</p>
    <h3>How to ingest</h3>
    <p>The app allows the user to configure how it should ingest emails on every scheduled poll either in the <i>oldest first</i> or the <i>latest first</i> order. Depending upon the scheduled interval and how busy the folder is, one of the following could potentially happen</p>
    <ul>
        <li>oldest first</li>
            If the app is configured to poll too slowly and the folder is so busy that on every poll the maximum ingested emails is less than the number of new emails, the app will never catch up.
        <li>latest first</li>
            If the app is configured to poll too slowly and the folder is so busy that on every poll the maximum ingested emails is less than the number of new emails, the app will drop the older emails since it is ingesting the latest emails that came into the mailbox.
    </ul>
    <p>For best results, keep the poll interval and <i>Maximum emails to poll</i> values close to the number of emails you would get within a time interval. This way, every poll will end up ingesting all the new emails.</p>
    <br>
    <p>In case the asset is configured to poll <b>oldest first</b>, it becomes important that the <i>Maximum number of emails to poll</i> configured should be greater than the maximum number of emails generated <b>per second</b>. If the app detects it got the maximum configured emails and all occurred in the same second, it will start polling from the next second in the next polling cycle.</p>

    <h2>Copy Email</h2>
<p>To use the copy email command, follow these steps:</p>
<ol>
<li>Navigate to the Investigation page.&nbsp;</li>
<li>Click <strong>Action</strong>.</li>
<li>In the search bar, search for the copy email command.</li>
<li>Click <strong>copy email</strong>.&nbsp;</li>
<li>Click <strong>exchange, </strong>or whatever asset name you created, as the asset you want to run the <strong>copy email</strong> command on.&nbsp;</li>
<li>Enter the ID. Each email in Exchange has a unique ID. You can get this email ID from an email artifact that was previously ingested, or by running a run query action.&nbsp;</li>
<li>Enter the email address of the user you want to copy the email from and the folder you want to copy the email to.</li>
<li>&nbsp;From the message ID, click the drop down arrow and click<strong> Run Action</strong>.</li>
<li>Enter the email and the folder you want to move it to.&nbsp;</li>
<li>&nbsp;Click <strong>Launch</strong>.&nbsp;</li>
</ol>
